{% extends "partials/base.html" %}


{% block page_name %}
<title>Group Detail</title>
{% endblock page_name %}

{% block script %}
<script>

    const POST = () => {
        const urls = "http://localhost:8000/";
        const opts = {
            method: 'POST',
            body: '{longUrl:"' + urls + '"}',
            cache: 'no-cache',
            headers: {
                "Content-Type": "application/json"
            },
            redirect: 'follow'
        };
        return opts;
    }



    const join_or_exit_group = (status) => {
        const massge = status == "JOIN" ? "그룹에 참여하시겠습니까?" : "그룹을 나가겠습니까?";
        if (confirm(massge)) {
            opts = POST();

            fetch("{%url 'groups:join-group' group.pk %}", opts)
                .then(function (response) {

                    if (response.redirected) {
                        window.location.href = response.url;
                    }
                });
        }
    }

</script>
{% endblock script %}


{% block content %}
<div class="group_detail container lg:w-8/12 md:w-1/2 xl:w-2/4 mx-auto my-10 flex flex-col p-6 mt-32">
    <div class="header flex">
        <span class="title border border-gray-400 w-10/12 p-6">
            {{group.title}}
        </span>
        <span class="leader border border-gray-400  w-2/12 p-6  text-center ml-2">
            {{group.leader}}
        </span>
    </div>
    <div class="notice border border-gray-400 mx-auto  w-full p-6 mt-3 h-56">
        <h2>{{group.notice}}</h2>
    </div>
    <div class="contents border border-gray-400 mx-auto w-full p-6 mt-3" style="height:400px">
        <h2>{{group.contents}}</h2>

    </div>

    <div class="mt-4 ">
        {% if join %}
        <button id="joinGroup" class="w-40 text-center float-right p-2 m-1 rounded bg-red-500 text-white text-xl"
            onclick="join_or_exit_group('EXIT')">
            그룹 나가기
        </button>
        <button id="createPlan" class="w-40 text-center float-right p-2 m-1 rounded bg-indigo-500 text-white text-xl"
            onclick="location.href='{% url "groups:plan-create" group.pk %}'">
            계획 등록하기
        </button>
        {%else%}

        {%if group.get_user_count != group.max_group_count%}
        <button id="joinGroup" class="w-40 text-center float-right p-2 m-1 rounded bg-red-500 text-white text-xl"
            onclick="join_or_exit_group('JOIN')">
            그룹 참여하기
        </button>
        {%endif%}

        {% endif %}
    </div>
    <div class="mt-4">

        <div class="float-right ">
            {% for user in group.users.all  %}
            <span class="p-2 rounded bg-gray-600  text-white ">{{user.username}}</span>
            {% endfor %}
        </div>
    </div>

    <div class="plan_list mt-5">

        {% for plan in plans %}
        <a href="{%url 'groups:plan-detail' group.pk plan.pk %}">
            <div class="plan_{{plan.id}} border border-gray400 rounded mt-3 p-3 bg-gray-100">

                <div class="detial max-w-full flex items-center justify-between">
                    <div class="p-2 bg-gray-100 font-bold text-lg">{{plan.user.username}}</div>
                    <div class="flex">
                        {% if plan.status == ENROLLMENT %}
                        <div
                            class="border border-gray400 p-1 bg-blue-400 rounded-lg text-gray-100 text-center h-8 w-16 text-sm">
                            등록</div>
                        <div class="p-1 ml-1">{{plan.created}}
                        </div>
                        {% else %}
                        <div
                            class="border border-gray400 p-1 bg-indigo-400 rounded-lg text-gray-100 text-center h-8 w-16 text-sm">
                            수정</div>
                        <div class="p-1 ml-1"> {{plan.updated}}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="confirm max-w-full flex items-center justify-between mt-1">
                    <div class="flex">
                        {% if plan.status != COMPLETE %}
                        <div
                            class="border border-gray400 p-1 bg-teal-400 rounded-lg text-gray-100 text-center h-8 w-16 text-sm">
                            계획
                        </div>
                        <div class="p-1 ml-1">
                            {{plan.title_for_plan}}
                        </div>
                        {% else %}
                        <div
                            class="border border-gray400 p-1 bg-teal-400 rounded-lg text-gray-100 text-center h-8 w-16 text-sm">
                            결과</div>
                        <div class="p-1 ml-1">
                            {{plan.title_for_result}}
                        </div>
                        {% endif %}
                    </div>
                    <div class="border border-gray400 p-1 rounded-lg text-gray-100 w-32 text-center h-8 text-sm
                        {%if plan.status == 'ENROLLMENT'%}
                        bg-teal-400  
                        {%elif plan.status == 'CONFIRM'%}
                        bg-indigo-400 
                        {%elif plan.status == 'COMPLETE'%}
                        bg-blue-400 
                        {%elif plan.status == 'FAIL'%}
                        bg-red-500 
                        {%elif plan.status == 'SUCCESS'%}
                        bg-green-400 
                        {%endif%}
                    ">
                        {{plan.status}}
                    </div>
                </div>
            </div>
        </a>

        {% endfor %}

    </div>
</div>


</div>
{% endblock content %}